{% extends "layout.html" %}
{% block body %}
<div class="row">
  <div class="col-md-12">
    <button type='button' class='btn btn-success pull-right'>Dismiss Anomaly</button>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading"> Information</div>
      <div class="panel-body">
        <strong>Sugested Anomaly Type:</strong> {{ anomalyType }}<br />
        <strong>Range:</strong> {{ anomalyStartTimestamp }} - {{ anomalyEndTimestamp }} <br />
        <strong>Anomaly Certainty</strong> {{ certantyPercentage }}% <br />
      </div>
    </div>
  </div>

  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">Price</div>
      <div class="panel-body">

        <div id="price_chart" style="style="min-height: 500px""></div>
      </div>
    </div>
  </div>

  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">Volume</div>
      <div class="panel-body">

        <div id="volume_chart" style="style="min-height: 500px""></div>
      </div>
    </div>
  </div>

  <div class="col-md-12">
    <div class="panel panel-default">
      <div class="panel-heading">Price</div>
      <div class="panel-body">

        <div id="container" style="width:100%; height:400px;"></div>
    </div>
  </div>

</div>
<div class="row">
  <div class="col-lg-12">
    <div class="panel panel-default">
      <div class="panel-heading">
        <i class="fa fa-bar-chart-o fa-fw"></i> Data
      </div>
      <div class="panel-body">
        <div class="row">
          <div class="col-lg-12">
            <div class="table-responsive">
              <table class="table table-bordered table-hover table-striped">
                <thead>
                  <tr>
                    <th>Time</th>
                    <th>Buyer</th>
                    <th>Seller</th>
                    <th>Price</th>
                    <th>Size</th>
                    <th>Currency</th>
                    <th>Symbol</th>
                    <th>Sector</th>
                    <th>Bid</th>
                    <th>Ask</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>{{ time }}</td>
                    <td>{{ buyer }}</td>
                    <td>{{ seller}}</td>
                    <td>{{ price }}</td>
                    <td>{{ size}}</td>
                    <td>{{ currency }}</td>
                    <td>{{ symbol }}</td>
                    <td>{{ sector }}</td>
                    <td>{{ bid }}</td>
                    <td>{{ ask }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<!-- Price Graph -->
<script type="text/javascript">
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);
function drawChart(){
	var data = ([
				 {%- for trade in trades %}
				 {%- if "{{ trade.time }}" == "{{ time }}" and "{{ trade.price }}" == "{{ price }}"  %}
					[{y:{{ time }}, x:{{ price }}, color: 'red'}]
				 {% else %}
					[Date.parse('{{ trade.time }}'),{{ trade.price }}]
				 {% endif %}
					{%- if not loop.last %},{% endif %}
				 {%- endfor %}]);
	var chart = Highcharts.chart('price_chart',{
					 chart: {
						 zoomType: 'x'
					 },
					 title: {
						 text: 'Price per trade in the past 24 hours'
					 },
					 subtitle: {
						 text: document.ontouchstart === undefined ?
						 'Click and drag in the plot area to zoom in' : 'Pinch the chart to zoom in'
					 },
					 xAxis: {
						 type: 'datetime'
					 },
					 yAxis: {
						 title: {
							 text: 'Stock price'
						 }
					 },
					 legend: {
						 enabled: false
					 },
					 rangeSelector: {
						 selected: 1
					 },
					 plotOptions: {
						 area: {
							 fillColor: {
								 linearGradient: {
								 x1: 0,
								 y1: 0,
								 x2: 0,
								 y2: 1
							 },
							 stops: [
									 [0, Highcharts.getOptions().colors[0]],
									 [1, Highcharts.Color(Highcharts.getOptions().colors[0]).setOpacity(0).get('rgba')]
									 ]
							 },
							 marker: {
								 radius: 2
							 },
							 lineWidth: 1,
							 states: {
								 hover: {
									 lineWidth: 1
								 }
							 },
							 threshold: null
						 }
					 },
					 series: [{
						  type: 'area',
						  name: 'price',
						  data: data
					  }]
				});
				chart.xAxis[0].setExtremes(Date.parse('{{ min }}'),Date.parse('{{ max }}'));
	chart.showResetZoom();
}
</script>
<!-- Volume Graph -->
<script type="text/javascript">
google.charts.load('current', {'packages':['corechart']});
google.charts.setOnLoadCallback(drawChart);

function drawChart() {
  var data = google.visualization.arrayToDataTable([
    ['Time', 'Volume'],
    {%- for trade in trades %}
    ['{{ trade.time }}', {{ trade.size }}]{%- if not loop.last %},{% endif %}
    {%- endfor %}
  ]);

  var options = {
    title: 'Volume of most recent trades',
    legend: { position: 'bottom' },
    chartArea: { height: "40%", width: "90%" }
  };

  var chart = new google.visualization.LineChart(document.getElementById('volume_chart'));

  chart.draw(data, options);
}
</script>

<script>
$(function () {
    var myChart = Highcharts.chart('container', {
        chart: {
            type: 'bar'
        },
        title: {
            text: 'Fruit Consumption'
        },
        xAxis: {
            categories: ['Apples', 'Bananas', 'Oranges']
        },
        yAxis: {
            title: {
                text: 'Fruit eaten'
            }
        },
        series: [{
            name: 'Jane',
            data: [1, 0, 4]
        }, {
            name: 'John',
            data: [5, 7, 3]
        }]
    });
});

</script>


</script>
{% endblock %}


{% block scripts %}
<script src="{{ url_for('static', filename='js/anomaly.js') }}"></script>
{% endblock %}
